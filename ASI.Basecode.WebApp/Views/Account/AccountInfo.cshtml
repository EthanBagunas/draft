@model IEnumerable<ASI.Basecode.Data.Models.User>
@using System.Collections.Generic
@using static ASI.Basecode.Resources.Views.Screen
@section Styles {
    <link rel="stylesheet" href="~/css/headerfinal.css" />
    <link rel="stylesheet" href="~/css/texts.css" />
    <link rel="stylesheet" href="~/css/style.css" />
    <link rel="stylesheet" href="~/css/admin-info.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <link rel="icon" type="image/svg+xml" href="~/img/logo-invert.svg">
}
<!--copy ang script-->
@section Scripts {
    <script src="~/js/modal.js"></script>
    <script>
        $(document).ready(function () {
            // Handle checkbox selection
            $('.employee-checkbox').on('change', function () {
                var selectedCount = $('.employee-checkbox:checked').length;

                // Enable/disable edit and delete buttons based on selection
                if (selectedCount === 1) {
                    $('#edit-button').prop('disabled', false);
                    $('#delete-button').prop('disabled', false);
                } else if (selectedCount > 1) {
                    $('#edit-button').prop('disabled', true);
                    $('#delete-button').prop('disabled', false);
                } else {
                    $('#edit-button').prop('disabled', true);
                    $('#delete-button').prop('disabled', true);
                }
            });

            // Handle delete button click
            $('#delete-button').click(function () {
                var selectedUsers = $('.employee-checkbox:checked').map(function () {
                    return $(this).data('user-id');
                }).get();

                if (confirm('Are you sure you want to delete the selected user(s)?')) {
                    selectedUsers.forEach(function (userId) {
                        $.ajax({
                            url: '@Url.Action("DeleteUser", "Account")',
                            type: 'POST',
                            data: { UserId: userId },
                            success: function () {
                                location.reload();
                            },
                            error: function (error) {
                                console.error('Error deleting user:', error);
                            }
                        });
                    });
                }
            });
        });

        // Add form submission handler
        $('#addUserForm').on('submit', function(e) {
    e.preventDefault();
    
    const userId = $(this).data('user-id'); // Get user ID from the form data
    const url = userId ? `/Account/EditUser/${userId}` : '/Account/AddUser'; // Adjust the URL based on action

    const formData = new FormData(this);
    
    $.ajax({
        url: url,
        method: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            if (response.success) {
                closeModal();
                location.reload(); // Reload the page to see the changes
            } else {
                alert('Error saving user');
            }
        },
        error: function(error) {
            alert('Error saving user: ' + error.responseText);
        }
    });
});
    </script>
}
    
@{
    ViewBag.LoginView = true;
    ViewData["Title"] = "Account Information";
}

<div class= "custom-main-container">
    <!--search -->
        <div class="custom-info-box">
            <input placeholder="Search...">
            <button><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>
        <div class ="custom-info-search-container">
        <div class = "info-page-title">
        <span class="page-title">Account Information</span>
        </div>

    </div>

    <!--table-->
    <div class="info-table-container">
        <div class="info-table">
            <table>
                <thead class="th-text">
                    <tr>
                        <th>Employee ID</th>
                        <th>Full Name</th>
                        <th>UserName</th>
                        <th>Contact Number</th>
                        <th>Tools</th>
                    </tr>
                </thead>
                <!--start sa content sa table-->
                <tbody class="td-text">
                    @foreach (var user in Model)
                    {
                        <tr>
                            <td>@user.Id</td>
                            <td>@user.Name</td>
                            <td>@user.UserId</td>
                            <td>@user.Contact</td>
                            <td>
                        <div class="grid-item-toolbar">
                            <button class="grid-toolbar-button" onclick="editUser(@user.Id)">
                                <i class="fa-regular fa-pen-to-square"></i>
                            </button>
                            <button class="grid-toolbar-button" onclick="deleteUser(@user.Id)">
                                <i class="fa-regular fa-trash-can" style="color: #b3261e;"></i>
                            </button>
                
                        </div>
                    </td>
                        </tr>
                    }
                </tbody>
        </table>
    </div>
</div>
 <div class="info-room-add-container">
    <button class="info-add-booking-btn custom-main-white-text-normal" id="addUserForm" onclick="openModal()">Add New User</button>
  </div>
       
 <!--modal html, copy ni-->
<div id="myModal" class="modal">
    <div class="modal-content">
        <div class="modal-header1">
            <h2>Add User</h2>
        </div>
        <form id="addUserForm">
                <label for="fullName">Full Name </label>
                <input type="text" id="fullName" name="fullName" placeholder="Enter full name" required>

                <label for="userName">UserName </label>
                <input type="text" id="userName" name="userName" placeholder="Enter username" required>

                <label for="contactNumber">Contact Number </label>
                <input type="text" id="contactNumber" name="contactNumber" placeholder="Enter contact number" required>
            <div class="modal-footer1">
                <button type="button" class="cancel-bttn" onclick="closeModal()">Cancel</button>
                <button type="submit" class="submit-bttn">Submit</button>
            </div>
        </form>
    </div>
    
</div>


<script>
function editUser(userId) {
    // Fetch user data (you can use AJAX to get user details)
    $.ajax({
        url: `/Account/GetUser/${userId}`, // Adjust the URL as needed
        type: 'GET',
        success: function(user) {
            // Populate the modal fields with user data
            $('#fullName').val(user.fullName);
            $('#userName').val(user.userName);
            $('#contactNumber').val(user.contactNumber);
            $('#addUserForm').attr('data-user-id', userId); // Store user ID in the form for submission
            openModal(); // Open the modal
        },
        error: function(error) {
            console.error('Error fetching user data:', error);
        }
    });
}
function deleteUser(userId) {
    if (confirm('Are you sure you want to delete this user?')) {
        $.ajax({
            url: `/Account/DeleteUser/${userId}`, // Adjust the URL as needed
            type: 'POST',
            success: function() {
                location.reload(); // Reload the page to see the changes
            },
            error: function(error) {
                console.error('Error deleting user:', error);
            }
        });
    }
}

function openModal() {
    const modal = document.getElementById('myModal');
    modal.classList.add('show');
    document.body.classList.add('modal-open');
}


function closeModal() {
    const modal = document.getElementById('myModal');
    modal.classList.remove('show');
    document.body.classList.remove('modal-open');
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('myModal');
    if (event.target === modal) {
        closeModal();
    }
}
</script>




