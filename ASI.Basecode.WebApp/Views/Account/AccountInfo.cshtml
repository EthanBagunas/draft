@model IEnumerable<ASI.Basecode.Data.Models.User>
@using System.Collections.Generic
@using static ASI.Basecode.Resources.Views.Screen
@section Styles {
    <link rel="stylesheet" href="~/css/headerfinal.css" />
    <link rel="stylesheet" href="~/css/texts.css" />
    <link rel="stylesheet" href="~/css/style.css" />
    <link rel="stylesheet" href="~/css/admin-info.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <link rel="icon" type="image/svg+xml" href="~/img/logo-invert.svg">
}
<!--copy ang script-->
@section Scripts {
    <script src="~/js/modal.js"></script>
    <script>
        $(document).ready(function () {
            // Handle checkbox selection
            $('.employee-checkbox').on('change', function () {
                var selectedCount = $('.employee-checkbox:checked').length;

                // Enable/disable edit and delete buttons based on selection
                if (selectedCount === 1) {
                    $('#edit-button').prop('disabled', false);
                    $('#delete-button').prop('disabled', false);
                } else if (selectedCount > 1) {
                    $('#edit-button').prop('disabled', true);
                    $('#delete-button').prop('disabled', false);
                } else {
                    $('#edit-button').prop('disabled', true);
                    $('#delete-button').prop('disabled', true);
                }
            });

            // Handle delete button click
            $('#delete-button').click(function () {
                var selectedUsers = $('.employee-checkbox:checked').map(function () {
                    return $(this).data('user-id');
                }).get();

                if (confirm('Are you sure you want to delete the selected user(s)?')) {
                    selectedUsers.forEach(function (userId) {
                        $.ajax({
                            url: '@Url.Action("DeleteUser", "Account")',
                            type: 'POST',
                            data: { UserId: userId },
                            success: function () {
                                location.reload();
                            },
                            error: function (error) {
                                console.error('Error deleting user:', error);
                            }
                        });
                    });
                }
            });
        });

        // Add form submission handler
        $('#addUserForm').on('submit', function(e) {
    e.preventDefault();
    
    const userId = $(this).data('user-id'); // Get user ID from the form data
    const url = userId ? `/Account/EditUser/${userId}` : '/Account/AddUser'; // Adjust the URL based on action

    const formData = new FormData(this);
    
    $.ajax({
        url: url,
        method: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            if (response.success) {
                closeModal();
                location.reload(); // Reload the page to see the changes
            } else {
                alert('Error saving user');
            }
        },
        error: function(error) {
            alert('Error saving user: ' + error.responseText);
        }
    });
});
    </script>
}
    
@{
    ViewBag.LoginView = true;
    ViewData["Title"] = "Account Information";
}

<div class= "custom-main-container">
    <!--search -->
        <div class="custom-info-box">
            <input placeholder="Search...">
            <button><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>
        <div class ="custom-info-search-container">
        <div class = "info-page-title">
        <span class="page-title">Account Information</span>
        </div>

    </div>

    <!--table-->
    <div class="info-table-container">
        <div class="info-table">
            <table>
                <thead class="th-text">
                    <tr>
                        <th>Employee ID</th>
                        <th>Full Name</th>
                        <th>UserName</th>
                        <th>Contact Number</th>
                        <th>Tools</th>
                    </tr>
                </thead>
                <!--start sa content sa table-->
                <tbody class="td-text">
                    @foreach (var user in Model)
                    {
                        <tr>
                            <td>@user.Id</td>
                            <td>@user.Name</td>
                            <td>@user.UserId</td>
                            <td>@user.Contact</td>
                            <td>
                                <div class="grid-item-toolbar">
                                    <button type='button' id='editbtn' class="grid-toolbar-button" onclick="openEditModal(@user.Id)">
                                        <i class="fa-regular fa-pen-to-square"></i>
                                    </button>
                                    <button type='button' id='delbtn' class="grid-toolbar-button" onclick="deleteUser(@user.Id)">
                                        <i class="fa-regular fa-trash-can" style="color: #b3261e;"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
        </table>
    </div>
</div>
 <div class="info-room-add-container">
    <button class="info-add-booking-btn custom-main-white-text-normal" id="addUserForm" onclick="openModal()">Add New User</button>
  </div>
       
 <!--modal html, copy ni-->
<div id="myModal" class="modal">
    <div class="modal-content">
        <div class="modal-header1">
            <h2>Add User</h2>
        </div>
        <form id="addUserForm">
                
                <label for="fullName">Full Name </label>
                <input type="text" id="fullName" name="fullName" placeholder="Enter full name" required>

                <label for="userName">UserName </label>
                <input type="text" id="userName" name="userName" placeholder="Enter username" required>

                <label for="contactNumber">Contact Number </label>
                <input type="text" id="contactNumber" name="contactNumber" placeholder="Enter contact number" required>
            <div class="modal-footer1">
                <button type="button" class="cancel-bttn" onclick="closeModal()">Cancel</button>
                <button type="submit" class="submit-bttn">Submit</button>
            </div>
        </form>
    </div>
    
</div>
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header1">
            <h2>Add User</h2>
        </div>
        <form id="editUserForm">
                <label for="uid">Id </label>
                <input type="text" id="uid" name="uid" readonly>
                <label for="firstname">First Name </label>
                <input type="text" id="efirstname" name="firstname" placeholder="Enter first name" required>
                <label for="lastname">Last Name </label>
                <input type="text" id="elastname" name="lastname" placeholder="Enter last name" required>
                
                <label for="euserid">Email </label>
                <input type="text" id="euserid" name="euserid" placeholder="Enter new email" required>

                <label for="econtactNumber">Contact Number </label>
                <input type="text" id="econtactNumber" name="econtactNumber" placeholder="Enter contact number" required>
                <label for="epassword">Password </label>
                <input type="text" id="epassword" name="epassword" placeholder="Enter contact number" required>
            <div class="modal-footer1">
                <button type="button" class="cancel-bttn" onclick="closeEditModal()">Cancel</button>
                <button type="submit" class="submit-bttn">Submit</button>
            </div>
        </form>
    </div>
    
</div>


<script>
document.getElementById('editUserForm').addEventListener('submit', editUser);
function editUser(event) {
    event.preventDefault();
    const uid = document.getElementById('uid').value;
    const firstName = document.getElementById('efirstname').value;
    const lastName = document.getElementById('elastname').value;
    const email = document.getElementById('euserid').value;
    const contactNumber = document.getElementById('econtactNumber').value;
    const password = document.getElementById('epassword').value;
    const name = firstName + ' ' + lastName;
    $.ajax({
        url: '/Account/UpdateUser/', // Adjust the URL as needed
        type: 'POST',
        data: {
            Id: uid,
            Name: name,
            UserId: email,
            Contact: contactNumber,
            Fname: firstName,
            Lname: lastName,
            Password: password
        },
        success: function() {
            location.reload(); // Reload the page to see the changes
        },
        error: function(error) {
            console.error('Error editing user:', error);
        }
    });
}
function deleteUser(userId) {
    if (confirm('Are you sure you want to delete this user?')) {
        $.ajax({
            url: `/Account/DeleteUser/`, // Adjust the URL as needed
            type: 'POST',
            data: {Id: userId},
            success: function() {
                location.reload(); // Reload the page to see the changes
            },
            error: function(error) {
                console.error('Error deleting user:', error);
            }
        });
    }
}

function openModal() {
    const modal = document.getElementById('myModal');
    modal.classList.add('show');
    document.body.classList.add('modal-open');
}


function closeModal() {
    const modal = document.getElementById('myModal');
    modal.classList.remove('show');
    document.body.classList.remove('modal-open');
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('myModal');
    if (event.target === modal) {
        closeModal();
    }
}
function openEditModal(userid) {
    document.getElementById('uid').value = userid;
    const modal = document.getElementById('editModal');
    modal.classList.add('show');
    document.body.classList.add('modal-open');
}


function closeEditModal() {
    const modal = document.getElementById('editModal');
    modal.classList.remove('show');
    document.body.classList.remove('modal-open');
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('editModal');
    if (event.target === modal) {
        closeEditModal();
    }
}

</script>




